# Production Environment Configuration - Web Service Only
# Copy this file to `.env` and fill in real values. Do NOT commit your real `.env`.
#
# This setup assumes you have:
# - PostgreSQL running on host (or accessible via network)
# - Redis running on host (or accessible via network) 
# - Nginx running on host (will serve static/media from ./static and ./media folders)
#
# The web container will:
# - Expose port 8000 (configurable via WEB_PORT)
# - Mount ./static, ./media, ./logs to host for nginx access
# - Connect to your external DB/Redis via DATABASE_URL/REDIS_URL

# =============================================================================
# DJANGO CORE SETTINGS
# =============================================================================

# Generate with: python -c "from django.core.management.utils import get_random_secret_key; print(get_random_secret_key())"
SECRET_KEY=your-super-secret-key-here-change-this

# ALWAYS False in production
DEBUG=False

# Your domain(s) - comma separated, no spaces
ALLOWED_HOSTS=yourdomain.com,www.yourdomain.com,api-corebackend.kancralabs.com

# =============================================================================
# CSRF & SECURITY CONFIGURATION
# =============================================================================

# CSRF trusted origins (IMPORTANT for production)
# Add ALL domains that will make requests to your Django app
CSRF_TRUSTED_ORIGINS=https://yourdomain.com,https://www.yourdomain.com,https://api-corebackend.kancralabs.com

# Additional CSRF settings
CSRF_COOKIE_SECURE=True
CSRF_COOKIE_HTTPONLY=True
CSRF_COOKIE_SAMESITE=Lax
CSRF_USE_SESSIONS=False

# Session security
SESSION_COOKIE_SECURE=True
SESSION_COOKIE_HTTPONLY=True
SESSION_COOKIE_SAMESITE=Lax

# =============================================================================
# DATABASE CONFIGURATION (External)
# =============================================================================

# Connect to your existing PostgreSQL
# Examples:
# - Host PostgreSQL: postgres://user:password@localhost:5432/dbname
# - Network PostgreSQL: postgres://user:password@192.168.1.100:5432/dbname
DATABASE_URL=postgres://postgres:your-secure-password@localhost:5432/core_backend

# =============================================================================
# REDIS CONFIGURATION (External)
# =============================================================================

# Connect to your existing Redis
# Examples:  
# - Host Redis: redis://localhost:6379/0
# - Network Redis: redis://192.168.1.100:6379/0
# - Redis with auth: redis://:password@localhost:6379/0
REDIS_URL=redis://localhost:6379/0

# =============================================================================
# WEB SERVICE CONFIGURATION
# =============================================================================

# Port to expose the web container (your nginx will proxy to this)
WEB_PORT=8000

# Gunicorn workers (adjust based on CPU cores: 2 * cores + 1)
GUNICORN_WORKERS=3
GUNICORN_TIMEOUT=120

# Container user settings
APP_UID=1000
APP_GID=1000

# =============================================================================
# SECURITY & PERFORMANCE
# =============================================================================

# CORS settings for frontend domains
CORS_ALLOWED_ORIGINS=https://yourdomain.com,https://www.yourdomain.com,https://api-corebackend.kancralabs.com
CORS_ALLOW_CREDENTIALS=True

# SSL/HTTPS settings (for nginx with SSL termination)
SECURE_SSL_REDIRECT=True
SECURE_PROXY_SSL_HEADER=HTTP_X_FORWARDED_PROTO,https
SECURE_HSTS_SECONDS=31536000
SECURE_HSTS_INCLUDE_SUBDOMAINS=True
SECURE_HSTS_PRELOAD=True
SECURE_CONTENT_TYPE_NOSNIFF=True
SECURE_BROWSER_XSS_FILTER=True

# Email backend (for production notifications)
EMAIL_BACKEND=django.core.mail.backends.smtp.EmailBackend
EMAIL_HOST=smtp.gmail.com
EMAIL_PORT=587
EMAIL_USE_TLS=True
EMAIL_HOST_USER=your-email@gmail.com
EMAIL_HOST_PASSWORD=your-app-password

# Logging level
LOG_LEVEL=INFO

# File upload limits
FILE_UPLOAD_MAX_MEMORY_SIZE=5242880
DATA_UPLOAD_MAX_MEMORY_SIZE=5242880

# =============================================================================
# DEPLOYMENT COMMANDS
# =============================================================================
# 
# Run migrations (production):
# docker compose -f docker-compose.manage.yml run --rm manage migrate
#
# Create superuser:
# docker compose -f docker-compose.manage.yml run --rm manage createsuperuser
#
# Collect static files:
# docker compose -f docker-compose.manage.yml run --rm manage collectstatic --noinput
#
# Start web service:
# docker compose -f docker-compose.prod.web.yml up -d --build
#
# =============================================================================
# NGINX CONFIGURATION NOTES
# =============================================================================
# Your nginx should:
# 1. Proxy requests to http://localhost:8000 (or WEB_PORT)
# 2. Serve static files from ./static/ directory
# 3. Serve media files from ./media/ directory  
# 4. Set proper headers: X-Forwarded-Proto, X-Real-IP, etc.
#
# Example nginx location blocks:
# location / { proxy_pass http://localhost:8000; }
# location /static/ { alias /path/to/your/project/static/; }
# location /media/ { alias /path/to/your/project/media/; }
